<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>{{ config.title or "Ultimate Countdown" }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/settings.css') }}">
</head>
<body>

<div class="uc-page">
    <header class="uc-header">
        <div>
            <h1 class="uc-title">Créer un compte à rebours</h1>
            <p class="uc-subtitle">
                1) Choisissez un template · 2) Personnalisez le design · 3) Récupérez le lien de l’image.
            </p>
        </div>
    </header>

    <div class="uc-layout">
        <!-- COLONNE GAUCHE : CONFIG -->
        <section class="uc-card">
            <form method="POST" id="countdownForm">
                <!-- champ caché pour template -->
                <input type="hidden" name="template" id="selectedTemplate" value="">
	            
	            <!-- TITRE -->
                <div class="uc-field uc-field-full">
                    <label for="title">
                        Titre du countdown
                        <span class="uc-hint">(utilisé pour le titre de l’onglet)</span>
                    </label>
                    <input type="text"
		                    id="title"
		                    name="title"
		                    value="{{ config.title or '' }}"
		                    placeholder="ex : Lancement V2, Promo Black Friday...">
                </div>
	            
	            <!-- ÉTAPE 1 : CHOIX TEMPLATE -->
                <section class="uc-section">
                    <h2 class="uc-section-title">1. Choisissez un template</h2>
                    <div class="uc-template-grid">
                        <button type="button" class="uc-template-btn" data-template="classic">Classic</button>
                        <button type="button" class="uc-template-btn" data-template="blocks">Blocks</button>
                        <button type="button" class="uc-template-btn" data-template="flip">Flip</button>
                        <button type="button" class="uc-template-btn" data-template="bubble">Bubble</button>
                        <button type="button" class="uc-template-btn" data-template="minimal">Minimal</button>
                        <button type="button" class="uc-template-btn" data-template="banner">Banner</button>
                        <button type="button" class="uc-template-btn" data-template="progress">Progress</button>
                    </div>
                </section>
	            
	            <!-- ÉTAPE 2 : OPTIONS DE DESIGN (générées en JS) -->
                <section class="uc-section" id="designSection" style="display:none;">
                    <h2 class="uc-section-title">2. Personnalisez le design</h2>
                    <div id="templateOptionsContainer"></div>
                </section>
	            
	            <!-- SUBMIT -->
                <button type="submit" class="uc-btn-primary">
                    ✨ Créer le GIF
                </button>
            </form>
        </section>
	    
	    <!-- COLONNE DROITE : PREVIEW -->
        <section class="uc-card uc-preview-card">
            <h2 class="uc-section-title">Aperçu</h2>
            <p class="uc-subtitle">
                C’est l’aperçu de votre compte à rebours. L’image servie sur l’URL sera mise à jour dynamiquement.
            </p>

            <div class="uc-preview-box">
    {% if img_link %}
        <img id="gifPreview" src="{{ img_link }}?{{ uuid }}" alt="Aperçu du GIF">
    {% else %}
        <p>Aucun aperçu encore — choisissez un template et créez votre premier countdown.</p>
    {% endif %}
</div>


            <div class="uc-divider"></div>

            <h3 class="uc-section-title uc-small">Lien de l’image dynamique</h3>
            {% if img_link %}
                <div class="uc-field">
                    <label>URL de l’image</label>
                    <input class="uc-link-input"
		                    readonly
		                    value="{{ img_link }}"
		                    onclick="this.select();">
                </div>
                <div class="uc-field">
                    <label>Code HTML à intégrer</label>
                    <pre class="uc-code">&lt;img src="{{ img_link }}" alt="Countdown"&gt;</pre>
                </div>
            {% else %}
                <p class="uc-subtitle">
                    Une fois le GIF créé, tu obtiendras ici l’URL à coller dans ton outil d’emailing.
                </p>
            {% endif %}
        </section>
    </div>
</div>

<script src="{{ url_for('static', filename='js/settings.js') }}"></script>
<script>
  const form = document.getElementById("countdownForm");
  const previewImg = document.getElementById("gifPreview");
  if (form && previewImg) {
	  form.addEventListener("input", () => {
		  const base = previewImg.src.split("?")[0];
		  previewImg.src = base + "?" + Date.now();
	  });
  }
</script>

</body>
</html>
